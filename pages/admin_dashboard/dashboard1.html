<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="shortcut icon" href="../../images/IconDiamond.png" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="/css/enhanced-typography.css" rel="stylesheet">
  <style>
    :root {
      /* === PARTIVOX DESIGN SYSTEM === */
      
      /* Core Background Colors */
      --primary-bg: #0a0a0f;
      --secondary-bg: #1a1a1f;
      --card-bg: #1e1e24;
      --sidebar-bg: #16161b;
      --surface-bg: #252530;
      --overlay-bg: rgba(10, 10, 15, 0.95);
      
      /* Lemon Green Brand Colors (Primary) */
      --accent-color: #caf403; /* signature lemon green */
      --accent-hover: #9dcf00; /* darker lemon green */
      --accent-light: #e8ff4d; /* lighter lemon green */
      --accent-dark: #7ba800; /* darkest lemon green */
      --accent-rgb: 202, 244, 3;
      
      /* Secondary Brand Colors */
      --primary-color: #667eea;
      --primary-hover: #5a67d8;
      --primary-light: #7c3aed;
      --primary-rgb: 102, 126, 234;
      
      /* Text Colors */
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --text-inverse: #000000;
      --text-accent: var(--accent-color);
      
      /* Status Colors */
      --success-color: #10b981;
      --success-light: #34d399;
      --warning-color: #f59e0b;
      --warning-light: #fbbf24;
      --danger-color: #ef4444;
      --danger-light: #f87171;
      --info-color: #3b82f6;
      --info-light: #60a5fa;
      
      /* Border & Divider Colors */
      --border-color: #27272a;
      --border-light: #374151;
      --border-accent: var(--accent-color);
      --divider-color: rgba(255, 255, 255, 0.1);
      
      /* Layout Variables */
      --sidebar-width: 280px;
      --sidebar-collapsed-width: 60px;
      --topbar-height: 70px;
      --border-radius: 12px;
      --border-radius-sm: 8px;
      --border-radius-lg: 16px;
      
      /* Spacing Scale */
      --space-xs: 0.25rem;    /* 4px */
      --space-sm: 0.5rem;     /* 8px */
      --space-md: 1rem;       /* 16px */
      --space-lg: 1.5rem;     /* 24px */
      --space-xl: 2rem;       /* 32px */
      --space-2xl: 3rem;      /* 48px */
      --space-3xl: 4rem;      /* 64px */
      
      /* Typography Scale */
      --text-xs: 0.75rem;     /* 12px */
      --text-sm: 0.875rem;    /* 14px */
      --text-base: 1rem;      /* 16px */
      --text-lg: 1.125rem;    /* 18px */
      --text-xl: 1.25rem;     /* 20px */
      --text-2xl: 1.5rem;     /* 24px */
      --text-3xl: 1.875rem;   /* 30px */
      --text-4xl: 2.25rem;    /* 36px */
      
      /* Animation & Transitions */
      --transition-fast: 0.15s ease;
      --transition-base: 0.2s ease;
      --transition-slow: 0.3s ease;
      --transition-bounce: 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      
      /* Shadows */
      --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
      --shadow-base: 0 4px 6px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 20px 25px rgba(0, 0, 0, 0.15);
      --shadow-accent: 0 0 0 3px rgba(202, 244, 3, 0.15);
      
      /* Z-Index Scale */
      --z-dropdown: 1000;
      --z-sticky: 1020;
      --z-fixed: 1030;
      --z-modal-backdrop: 1040;
      --z-modal: 1050;
      --z-popover: 1060;
      --z-tooltip: 1070;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, var(--primary-bg) 0%, #0f0f14 100%);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      font-size: 14px;
      font-weight: 400;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }

    .sidebar {
      height: 100vh;
      background: linear-gradient(180deg, var(--sidebar-bg) 0%, #12121a 100%);
      border-right: 1px solid var(--border-color);
      position: fixed;
      width: 280px;
      z-index: 1000;
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
    }

    .sidebar.collapsed {
      transform: translateX(-240px);
      width: 60px;
    }

    .sidebar.collapsed .logo h4 {
      opacity: 0;
      visibility: hidden;
    }

    .sidebar.collapsed .nav-section h6 {
      opacity: 0;
      visibility: hidden;
    }

    .sidebar.collapsed a span {
      opacity: 0;
      visibility: hidden;
    }

    .sidebar .logo {
      padding: 2rem 1.5rem;
      border-bottom: 1px solid var(--border-color);
    }

    .sidebar .logo h4 {
      font-weight: 700;
      font-size: 1.5rem;
      background: linear-gradient(135deg, var(--accent-color), #9dcf00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .sidebar .nav-section {
      padding: 1rem 0;
    }

    .sidebar .nav-section h6 {
      color: var(--text-muted);
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0 1.5rem;
      margin-bottom: 0.5rem;
    }

    .sidebar a {
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      padding: 0.75rem 1.5rem;
      text-decoration: none;
      transition: all 0.2s ease;
      border-radius: 0;
      position: relative;
    }

    .sidebar a i {
      width: 20px;
      margin-right: 12px;
      font-size: 1rem;
    }

    .sidebar a:hover {
      background: rgba(202, 244, 3, 0.1);
      color: var(--text-primary);
      transform: translateX(4px);
    }

    .sidebar a.active {
      background: linear-gradient(90deg, var(--accent-color), transparent);
      color: var(--text-primary);
      border-right: 3px solid var(--accent-color);
    }

    .sidebar a.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--accent-color);
    }

    .main-content {
      margin-left: 280px;
      min-height: 100vh;
      transition: margin-left 0.3s ease;
    }

    .main-content.sidebar-collapsed {
      margin-left: 60px;
    }

    .content {
      padding: 2rem;
      background: transparent;
    }

    .sidebar-toggle {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
    }

    .sidebar-toggle:hover {
      background: var(--accent-color);
      color: #000;
      transform: scale(1.05);
    }

    .topbar {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid var(--border-color);
      backdrop-filter: blur(10px);
    }

    .topbar h4 {
      font-weight: 700;
      font-size: 1.75rem;
      margin-bottom: 0.25rem;
    }

    .topbar p {
      color: var(--text-secondary);
      margin: 0;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-avatar {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      border: 2px solid var(--accent-color);
    }

    .search-input {
      background: var(--secondary-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 0.75rem 1rem;
      color: var(--text-primary);
      width: 300px;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(202, 244, 3, 0.15);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 1.5rem;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      border-color: var(--accent-color);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--accent-color), #9dcf00);
    }

    .stat-card h6 {
      color: var(--text-secondary);
      font-size: 0.875rem;
      font-weight: 500;
      margin-bottom: 0.5rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .stat-card h3 {
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .stat-card small {
      color: var(--text-muted);
      font-size: 0.75rem;
    }

    .content-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }

    .content-card h6 {
      font-size: 1.125rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 1rem;
      letter-spacing: -0.025em;
      line-height: 1.4;
    }

    /* Enhanced Typography */
    h1, h2, h3, h4, h5, h6 {
      font-weight: 600;
      line-height: 1.4;
      letter-spacing: -0.025em;
      color: var(--text-primary);
    }

    p {
      line-height: 1.6;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .text-muted {
      color: var(--text-muted) !important;
    }

    .text-secondary {
      color: var(--text-secondary) !important;
    }

    .text-primary {
      color: var(--text-primary) !important;
    }

    /* Better text contrast */
    .table th {
      color: var(--text-primary);
      font-weight: 600;
    }

    .table td {
      color: var(--text-secondary);
    }

    /* Form text styling */
    .form-control {
      color: var(--text-primary);
      background-color: var(--secondary-bg);
      border-color: var(--border-color);
    }

    .form-control:focus {
      color: var(--text-primary);
      background-color: var(--secondary-bg);
      border-color: var(--accent-color);
      box-shadow: 0 0 0 0.2rem rgba(202, 244, 3, 0.25);
    }

    .form-control::placeholder {
      color: var(--text-muted);
    }

    .table {
      color: var(--text-secondary);
      background: transparent;
    }

    .table th {
      color: var(--text-muted);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 0.75rem;
    }

    .table td {
      border-bottom: 1px solid rgba(39, 39, 42, 0.5);
      padding: 1rem 0.75rem;
      vertical-align: middle;
    }

    .table tbody tr:hover {
      background: rgba(202, 244, 3, 0.05);
    }

    .badge {
      padding: 0.375rem 0.75rem;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.2);
      color: var(--success-color);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.2);
      color: var(--warning-color);
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .badge-danger {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger-color);
      border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .btn {
      border-radius: 8px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: var(--accent-color);
      border-color: var(--accent-color);
      color: #000;
    }

    .btn-primary:hover,
    .btn-primary:focus {
      background: var(--accent-hover);
      border-color: var(--accent-hover);
      color: #000;
      transform: translateY(-1px);
    }

    .btn-outline-light {
      border-color: var(--border-color);
      color: var(--text-secondary);
    }

    .btn-outline-light:hover {
      background: var(--accent-color);
      border-color: var(--accent-color);
      color: #000;
    }

    .chart-container {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 16px;
      padding: 1.5rem;
    }

    .activity-item {
      display: flex;
      align-items: center;
      padding: 1rem 0;
      border-bottom: 1px solid rgba(39, 39, 42, 0.5);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      background: rgba(202, 244, 3, 0.1);
      color: var(--accent-color);
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        width: 280px;
      }

      .sidebar.show {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .main-content.sidebar-collapsed {
        margin-left: 0;
      }

      .topbar {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch !important;
      }

      .topbar .d-flex {
        justify-content: center;
      }

      .user-info {
        justify-content: center;
        flex-wrap: wrap;
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }

      .search-input {
        width: 100%;
        max-width: 300px;
      }

      .content-card {
        padding: 1rem;
      }

      .table-responsive {
        font-size: 0.875rem;
      }

      .activity-item {
        padding: 0.75rem;
      }
    }

    @media (max-width: 576px) {
      .topbar {
        padding: 1rem;
        margin-bottom: 1rem;
      }

      .topbar h4 {
        font-size: 1.125rem;
      }

      .topbar p {
        font-size: 0.8rem;
      }

      .content {
        padding: 0.75rem;
      }

      .stats-grid {
        gap: 0.75rem;
      }

      .stats-card {
        padding: 0.875rem;
      }

      .stats-card h3 {
        font-size: 1.25rem;
      }

      .stats-card p {
        font-size: 0.75rem;
      }

      .table th,
      .table td {
        padding: 0.375rem 0.25rem;
        font-size: 0.7rem;
      }

      .user-avatar {
        width: 28px;
        height: 28px;
      }

      .activity-item {
        padding: 0.5rem;
      }

      .activity-item h6 {
        font-size: 0.8rem;
      }

      .activity-item small {
        font-size: 0.7rem;
      }

      .content-card {
        padding: 0.875rem;
        margin-bottom: 1rem;
      }

      .content-card h6 {
        font-size: 0.95rem;
        margin-bottom: 0.75rem;
      }

      .sidebar-toggle {
        width: 40px;
        height: 40px;
      }

      .search-input {
        font-size: 0.875rem;
        padding: 0.5rem 0.75rem;
      }
    }

    @media (max-width: 480px) {
      .topbar {
        padding: 0.75rem;
      }

      .topbar h4 {
        font-size: 1rem;
      }

      .content {
        padding: 0.5rem;
      }

      .stats-card {
        padding: 0.75rem;
      }

      .stats-card h3 {
        font-size: 1.125rem;
      }

      .table th,
      .table td {
        padding: 0.25rem 0.125rem;
        font-size: 0.65rem;
      }

      .user-avatar {
        width: 24px;
        height: 24px;
      }

      .sidebar-toggle {
        width: 36px;
        height: 36px;
      }
    }

    .loading-skeleton {
      background: linear-gradient(90deg, var(--border-color) 25%, rgba(39, 39, 42, 0.5) 50%, var(--border-color) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">
      <h4>
        <img src="../../images/IconDiamond.png" alt="" width="24" height="24" class="me-2">
        PARTIVOX
      </h4>
    </div>
    
    <div class="nav-section">
      <h6>Main</h6>
      <a href="/pages/admin_dashboard/dashboard1.html" class="active">
        <i class="fas fa-chart-line"></i>
        <span>Overview</span>
      </a>
      <a href="/pages/admin_dashboard/user.html">
        <i class="fas fa-users"></i>
        <span>Users</span>
      </a>
      <a href="/pages/admin_dashboard/campaigns.html">
        <i class="fas fa-bullhorn"></i>
        <span>Campaigns</span>
      </a>
    </div>
    
    <div class="nav-section">
      <h6>Management</h6>
      <a href="/pages/admin_dashboard/transactions.html">
        <i class="fas fa-credit-card"></i>
        <span>Transactions</span>
      </a>
      <a href="/pages/admin_dashboard/reports.html">
        <i class="fas fa-chart-bar"></i>
        <span>Reports</span>
      </a>
      <a href="/pages/admin_dashboard/settings.html">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </a>
    </div>
    
    <div class="nav-section mt-auto">
      <a href="#" class="text-danger" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </a>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="content">
      <!-- Top bar -->
      <div class="topbar d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center gap-3">
          <div class="sidebar-toggle" id="sidebarToggle">
            <i class="fas fa-bars"></i>
          </div>
          <div>
            <h4>Dashboard Overview</h4>
            <p>Monitor platform performance with real-time analytics, user statistics, campaign metrics, and comprehensive administrative insights</p>
          </div>
        </div>
        <div class="user-info">
          <input type="text" class="search-input" placeholder="Search campaigns, users..." />
          <img src="../../images/avartar1.jpg" class="user-avatar" alt="avatar" />
          <div>
            <div id="adminName" class="fw-semibold">Admin</div>
            <small class="text-muted">Administrator</small>
          </div>
        </div>
      </div>
      
      <!-- Error display area -->
      <div id="errorDisplay" style="display:none;" class="alert alert-danger position-fixed top-0 start-50 translate-middle-x mt-3" role="alert"></div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <h6>Total Users</h6>
          <h3 id="total-users">0</h3>
          <small>
            <i class="fas fa-envelope text-info me-1"></i>
            <span id="email-users">0</span> Email
            <span class="mx-2">‚Ä¢</span>
            <i class="fab fa-twitter text-info me-1"></i>
            <span id="twitter-users">0</span> Twitter
          </small>
        </div>
        
        <div class="stat-card">
          <h6>New Users Today</h6>
          <h3 id="today-users">0</h3>
          <small>
            <i class="fas fa-arrow-up text-success me-1"></i>
            <span id="recent-users">0</span> this week
          </small>
        </div>
        
        <div class="stat-card">
          <h6>User Verification</h6>
          <h3 id="verified-users">0</h3>
          <small>
            <i class="fas fa-clock text-warning me-1"></i>
            <span id="unverified-users">0</span> pending
          </small>
        </div>
        
        <div class="stat-card">
          <h6>Active Campaigns</h6>
          <h3 id="active-campaigns">0</h3>
          <small>
            <i class="fas fa-chart-line text-success me-1"></i>
            0% from last month
          </small>
        </div>
      </div>

      <!-- Recent Users Section -->
      <div class="content-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6>Recent User Registrations</h6>
          <button class="btn btn-sm btn-outline-light" onclick="refreshRecentUsers()">
            <i class="fas fa-sync-alt me-1"></i>
            Refresh
          </button>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>User</th>
                <th>Email</th>
                <th>Provider</th>
                <th>Status</th>
                <th>Joined</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="recent-users-table">
              <tr>
                <td colspan="6" class="text-center py-4">
                  <div class="loading-skeleton" style="height: 20px; border-radius: 4px;"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Analytics and Activity -->
      <div class="row">
        <div class="col-lg-8">
          <div class="chart-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6>User Growth Analytics</h6>
              <select class="form-select w-auto bg-dark text-light border-secondary">
                <option selected>Last 7 days</option>
                <option>Last 30 days</option>
                <option>Last 3 months</option>
              </select>
            </div>
            <canvas id="userChart" height="100"></canvas>
          </div>
        </div>
        
        <div class="col-lg-4">
          <div class="content-card">
            <h6>Recent Activity</h6>
            <div class="activity-feed">
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-user-plus"></i>
                </div>
                <div class="flex-grow-1">
                  <div class="fw-semibold">New user registered</div>
                  <small class="text-muted">@crypto_enthusiast joined via Twitter</small>
                  <div class="text-muted small">2 minutes ago</div>
                </div>
              </div>
              
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-trophy"></i>
                </div>
                <div class="flex-grow-1">
                  <div class="fw-semibold">Campaign completed</div>
                  <small class="text-muted">@airdrop_hunter earned 500 üíé</small>
                  <div class="text-muted small">5 minutes ago</div>
                </div>
              </div>
              
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-coins"></i>
                </div>
                <div class="flex-grow-1">
                  <div class="fw-semibold">Reward distributed</div>
                  <small class="text-muted">1,200 üíé sent to @web3_warrior</small>
                  <div class="text-muted small">12 minutes ago</div>
                </div>
              </div>
              
              <div class="activity-item">
                <div class="activity-icon">
                  <i class="fas fa-bullhorn"></i>
                </div>
                <div class="flex-grow-1">
                  <div class="fw-semibold">New campaign created</div>
                  <small class="text-muted">"Twitter Engagement Boost" is now live</small>
                  <div class="text-muted small">1 hour ago</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Campaign Oversights -->
      <div class="content-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h6>Campaign Oversights</h6>
          <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline-light" onclick="refreshCampaigns()">
              <i class="fas fa-sync-alt me-1"></i>
              Refresh
            </button>
            <a href="/pages/admin_dashboard/campaigns.html" class="btn btn-sm btn-primary">
              <i class="fas fa-external-link-alt me-1"></i>
              Manage All
            </a>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Campaign</th>
                <th>Creator</th>
                <th>Budget</th>
                <th>Status</th>
                <th>Created</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="campaigns-table">
              <tr>
                <td colspan="6" class="text-center py-4">
                  <div class="loading-skeleton" style="height: 20px; border-radius: 4px;"></div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Role-based access control -->
  <script src="../../javascript/roleCheck.js"></script>
  <script>
  // Define API base URL early so all functions below can use it safely
  // Dynamic API base URL to match current origin
  const API_BASE_URL = window.location.origin + "/";
    // Defensive fetch wrapper for dashboard API calls
async function safeFetchJson(url, options = {}) {
  try {
    const response = await fetch(url, options);
    
    // Handle 401 Unauthorized - redirect to login
    if (response.status === 401) {
      localStorage.removeItem('authToken');
      window.location.href = 'login.html';
      return null;
    }
    
    const text = await response.text();
    let data;
    try {
      data = JSON.parse(text);
    } catch (e) {
      showError('Server error or invalid response');
      console.error('JSON parse error:', e, 'Response text:', text);
      return null;
    }
    
    if (!response.ok) {
      showError(data && data.message ? data.message : `Server error: ${response.status}`);
      return null;
    }
    
    if (data.status === 'error') {
      showError(data.message || 'Unknown error occurred');
      return null;
    }
    
    return data;
  } catch (err) {
    console.error('Network error:', err);
    showError('Network error: ' + err.message);
    return null;
  }
}

// Update dashboard fetches to use safeFetchJson
async function fetchTotalUsers() {
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/total-users`, {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
  });
  if (data && data.status === 'success') {
    const totalUsersElement = document.getElementById('total-users');
    if (totalUsersElement) {
      totalUsersElement.textContent = data.data?.total || data.total || 0;
    }
  }
}

async function fetchDashboardStats() {
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/dashboard`, {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
  });
  if (data && data.status === 'success') {
    // Update user statistics
    document.getElementById('total-users').textContent = data.data.total_users;
    document.getElementById('email-users').textContent = data.data.email_users;
    document.getElementById('twitter-users').textContent = data.data.twitter_users;
    document.getElementById('today-users').textContent = data.data.today_users;
    document.getElementById('recent-users').textContent = data.data.recent_users;
    document.getElementById('verified-users').textContent = data.data.verified_users;
    document.getElementById('unverified-users').textContent = data.data.unverified_users;
    document.getElementById('active-campaigns').textContent = data.data.active_campaigns;
    
    console.log('Dashboard stats updated:', data.data);
  }
}

// Fetch recent users for the table
async function fetchRecentUsers() {
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/recent-users?limit=10`, {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
  });
  
  const tableBody = document.getElementById('recent-users-table');
  
  if (data && data.status === 'success' && data.data.length > 0) {
    tableBody.innerHTML = data.data.map(user => `
      <tr>
        <td>${user.name}</td>
        <td>${user.email}</td>
        <td>
          <span class="badge ${user.auth_provider === 'twitter' ? 'bg-info' : 'bg-secondary'}">
            ${user.auth_provider === 'twitter' ? 'üê¶ Twitter' : 'üìß Email'}
          </span>
        </td>
        <td>
          <span class="badge ${user.is_verified ? 'bg-success' : 'bg-warning'}">
            ${user.status}
          </span>
        </td>
        <td>${user.created_at}</td>
      </tr>
    `).join('');
  } else {
    tableBody.innerHTML = '<tr><td colspan="5" class="text-center text-muted">No recent users found</td></tr>';
  }
}

// Refresh recent users
function refreshRecentUsers() {
  fetchRecentUsers();
}

async function fetchActiveCampaigns() {
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/campaigns?status=active`, {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
  });
  // update dashboard with active campaigns if needed
}

async function fetchTotalPayments() {
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/dashboard`, {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
  });
  if (data && data.status === 'success') {
    // Update revenue display if element exists (dashboard doesn't have revenue card currently)
    console.log('Revenue data:', data.data.total_revenue);
  }
}

async function fetchRecentActivity() {
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/reports?status=completed`, {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
  });
  // update dashboard with recent activity if needed
}

async function fetchActiveUsersTrend() {
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/dashboard`, {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
  });
  // update chart with data.data.active_users_trend if available
}

// Helper: Safely format dates to prevent "Invalid Date" errors
function formatDate(dateString) {
  if (!dateString) return '-';
  
  try {
    let date;
    if (dateString instanceof Date) {
      date = dateString;
    } else if (dateString && typeof dateString === 'object' && dateString.$date) {
      date = new Date(dateString.$date);
    } else {
      date = new Date(dateString);
    }
    
    if (isNaN(date.getTime())) {
      return 'Unknown Date';
    }
    
    return date.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
  } catch (error) {
    console.error('Error formatting date:', dateString, error);
    return 'Invalid Date';
  }
}

async function fetchAllCampaigns() {
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/campaigns?limit=5`, {
    headers: { 'Authorization': `Bearer ${localStorage.getItem('authToken')}` }
  });
  
  const tableBody = document.getElementById('campaigns-table');
  
  if (data && data.status === 'success' && data.data && data.data.length > 0) {
    tableBody.innerHTML = data.data.map(campaign => {
      // Extract campaign ID properly
      let id = '';
      if (campaign._id) {
        if (typeof campaign._id === 'string') {
          id = campaign._id;
        } else if (campaign._id.$oid) {
          id = campaign._id.$oid;
        } else if (campaign._id.toString) {
          id = campaign._id.toString();
        }
      } else if (campaign.id) {
        id = campaign.id;
      }
      
      const status = campaign.status || 'draft';
      const createdAt = formatDate(campaign.created_at);
      
      // Status badge styling
      let badgeClass = 'badge bg-secondary';
      if (status === 'active') badgeClass = 'badge bg-success';
      else if (status === 'suspended') badgeClass = 'badge bg-warning';
      else if (status === 'rejected') badgeClass = 'badge bg-danger';
      else if (status === 'pending') badgeClass = 'badge bg-info';
      
      return `
        <tr data-campaign-id="${id}">
          <td>
            <div class="fw-semibold">${campaign.title || campaign.name || 'Untitled Campaign'}</div>
            <small class="text-muted">${(campaign.description || '').substring(0, 50)}${campaign.description && campaign.description.length > 50 ? '...' : ''}</small>
          </td>
          <td>
            <div class="fw-semibold">${campaign.user_name || campaign.user || 'Unknown'}</div>
            <small class="text-muted">${campaign.user_email || ''}</small>
          </td>
          <td>
            <span class="fw-semibold">${campaign.diamonds || campaign.budget || 0}</span>
            <small class="text-muted d-block">üíé Diamonds</small>
          </td>
          <td>
            <span class="${badgeClass}">${status.charAt(0).toUpperCase() + status.slice(1)}</span>
          </td>
          <td>
            <small class="text-muted">${createdAt}</small>
          </td>
          <td>
            <div class="btn-group">
              <button class="btn btn-sm btn-outline-light" onclick="viewCampaign('${id}')" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
              ${status === 'draft' || status === 'pending' ? 
                `<button class="btn btn-sm btn-success" onclick="approveCampaign('${id}')" title="Approve">
                  <i class="fas fa-check"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="rejectCampaign('${id}')" title="Reject">
                  <i class="fas fa-times"></i>
                </button>` :
                `<button class="btn btn-sm ${status === 'active' ? 'btn-warning' : 'btn-success'}" 
                        onclick="toggleCampaignStatus('${id}', '${status}')" 
                        title="${status === 'active' ? 'Suspend' : 'Activate'}">
                  <i class="fas fa-${status === 'active' ? 'pause' : 'play'}"></i>
                </button>`
              }
            </div>
          </td>
        </tr>
      `;
    }).join('');
  } else {
    tableBody.innerHTML = '<tr><td colspan="6" class="text-center text-muted py-4">No campaigns found</td></tr>';
  }
}

// Refresh campaigns
function refreshCampaigns() {
  fetchAllCampaigns();
}

// Campaign action functions
function viewCampaign(campaignId) {
  window.open(`/pages/admin_dashboard/campaigns.html?view=${campaignId}`, '_blank');
}

async function approveCampaign(campaignId) {
  if (!confirm('Approve this campaign?')) return;
  
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/campaigns/approve`, {
    method: 'PUT',
    headers: { 
      'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ campaign_id: campaignId })
  });
  
  if (data && data.status === 'success') {
    showNotification('Campaign approved successfully!', 'success');
    fetchAllCampaigns();
    fetchDashboardStats(); // Refresh stats
  }
}

async function rejectCampaign(campaignId) {
  const reason = prompt('Enter rejection reason:');
  if (!reason) return;
  
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/campaigns/reject`, {
    method: 'PUT',
    headers: { 
      'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ campaign_id: campaignId, reason: reason })
  });
  
  if (data && data.status === 'success') {
    showNotification('Campaign rejected successfully!', 'warning');
    fetchAllCampaigns();
    fetchDashboardStats(); // Refresh stats
  }
}

async function toggleCampaignStatus(campaignId, currentStatus) {
  const newStatus = currentStatus === 'active' ? 'suspended' : 'active';
  const action = newStatus === 'suspended' ? 'suspend' : 'activate';
  
  if (!confirm(`${action.charAt(0).toUpperCase() + action.slice(1)} this campaign?`)) return;
  
  const data = await safeFetchJson(`${API_BASE_URL}api/admin/campaigns/status`, {
    method: 'PUT',
    headers: { 
      'Authorization': `Bearer ${localStorage.getItem('authToken')}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({ campaign_id: campaignId, status: newStatus })
  });
  
  if (data && data.status === 'success') {
    showNotification(`Campaign ${action}d successfully!`, newStatus === 'suspended' ? 'warning' : 'success');
    fetchAllCampaigns();
    fetchDashboardStats(); // Refresh stats
  }
}

// Call all fetches on page load
window.addEventListener('DOMContentLoaded', () => {
  // Debug: Check if we have a token
  console.log('üîç Dashboard loading - Token check:', localStorage.getItem('authToken') ? 'Present' : 'Missing');
  
  // Initialize dashboard
  fetchDashboardStats();
  fetchRecentUsers();
  fetchActiveCampaigns();
  fetchTotalPayments();
  fetchRecentActivity();
  fetchActiveUsersTrend();
  fetchAllCampaigns();
  
  // Auto-refresh recent users every 30 seconds
  setInterval(fetchRecentUsers, 30000);
});
  const ctx = document.getElementById('userChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        datasets: [{
          label: 'Active Users',
          data: [5, 20, 40, 60, 55, 70, 90],
          borderColor: '#9b59b6',
          backgroundColor: 'rgba(155, 89, 182, 0.1)',
          fill: true,
          tension: 0.4
        }]
      },
      options: {
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: { color: '#aaa' }
          },
          x: {
            ticks: { color: '#aaa' }
          }
        }
      }
    });

    // Display admin name from JWT token
    window.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('authToken');
      if (token) {
        const payload = JSON.parse(atob(token.split('.')[1]));
        const name = payload.data && payload.data.name ? payload.data.name : (payload.data && payload.data.email ? payload.data.email.split('@')[0] : '');
        const nameDiv = document.getElementById('adminName');
        if (nameDiv) {
          nameDiv.textContent = name ? `@${name}` : '';
        }
      }
    });
    // Helper to show errors on page
    function showError(message) {
      const errorDiv = document.getElementById('errorDisplay');
      if (errorDiv) {
        errorDiv.textContent = message;
        errorDiv.style.display = 'block';
        setTimeout(() => { errorDiv.style.display = 'none'; }, 5000);
      }
    }

    // SIDEBAR TOGGLE FUNCTIONALITY
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.querySelector('.sidebar');
    const mainContent = document.querySelector('.main-content');
    
    if (sidebarToggle && sidebar && mainContent) {
      sidebarToggle.addEventListener('click', () => {
        // Check if we're on mobile
        const isMobile = window.innerWidth <= 768;
        
        if (isMobile) {
          // On mobile, toggle the 'show' class
          sidebar.classList.toggle('show');
        } else {
          // On desktop, toggle the 'collapsed' class
          sidebar.classList.toggle('collapsed');
          mainContent.classList.toggle('sidebar-collapsed');
        }
        
        // Change icon based on state
        const icon = sidebarToggle.querySelector('i');
        if (isMobile) {
          if (sidebar.classList.contains('show')) {
            icon.className = 'fas fa-times';
          } else {
            icon.className = 'fas fa-bars';
          }
        } else {
          if (sidebar.classList.contains('collapsed')) {
            icon.className = 'fas fa-chevron-right';
          } else {
            icon.className = 'fas fa-bars';
          }
        }
      });
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', (e) => {
        const isMobile = window.innerWidth <= 768;
        if (isMobile && sidebar.classList.contains('show')) {
          if (!sidebar.contains(e.target) && !sidebarToggle.contains(e.target)) {
            sidebar.classList.remove('show');
            sidebarToggle.querySelector('i').className = 'fas fa-bars';
          }
        }
      });
      
      // Handle window resize
      window.addEventListener('resize', () => {
        const isMobile = window.innerWidth <= 768;
        const icon = sidebarToggle.querySelector('i');
        
        if (!isMobile) {
          // Reset mobile classes when switching to desktop
          sidebar.classList.remove('show');
          icon.className = sidebar.classList.contains('collapsed') ? 'fas fa-chevron-right' : 'fas fa-bars';
        } else {
          // Reset desktop classes when switching to mobile
          sidebar.classList.remove('collapsed');
          mainContent.classList.remove('sidebar-collapsed');
          icon.className = sidebar.classList.contains('show') ? 'fas fa-times' : 'fas fa-bars';
        }
      });
    }

    // LOGOUT FUNCTIONALITY - Now handled by admin-auth.js
    // The logout button will be automatically configured by the auth system

    // Initialize dashboard
    fetchDashboardStats();
    fetchRecentUsers();

    // Helper: Show notification
    function showNotification(message, type = 'success') {
      const notif = document.createElement('div');
      notif.className = `alert alert-${type}`;
      notif.style.position = 'fixed';
      notif.style.top = '20px';
      notif.style.right = '20px';
      notif.style.zIndex = 9999;
      notif.innerText = message;
      document.body.appendChild(notif);
      setTimeout(() => notif.remove(), 2500);
    }

    // Campaign action buttons are now handled by inline onclick functions
  </script>
  <script src="/pages/admin_dashboard/js/admin-auth.js"></script>
</body>
</html>
